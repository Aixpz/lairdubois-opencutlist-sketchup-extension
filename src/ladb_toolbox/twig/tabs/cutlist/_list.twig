{# set errors #}
{# set warnings #}
{# set groups #}

{% include 'core/_alert-errors.twig' %}
{% include 'core/_alert-warnings.twig' %}

{% if groups|length > 0 %}
    <table id="ladb_summary" class="no-print table table-bordered ladb-cutlist">
        <thead>
        <tr style="background-color: #eee;">
            <td colspan="5" style="line-height: 20px;">
                <button class="no-print btn btn-default btn-sm ladb-btn-toggle-no-print pull-left" data-group-id="ladb_summary"><i class="ladb-toolbox-icon-eye-open"></i></button>
                <div>
                    <span style=" line-height: 25px; font-size: 18px;">{{ 'tab.cutlist.list.summary'|i18next }}</span>
                </div>
            </td>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td class="text-center" width="5%">{{ 'tab.cutlist.list.type'|i18next }}</td>
            <td class="text-center" width="55%">{{ 'tab.cutlist.list.material'|i18next }}</td>
            <td class="text-center" width="10%">{{ 'tab.cutlist.list.part_count'|i18next }}</td>
            <td class="text-center" width="15%">{{ 'tab.cutlist.list.area'|i18next }}Surface</td>
            <td class="text-center" width="15%">{{ 'tab.cutlist.list.volume'|i18next }}</td>
        </tr>
        {% for group in groups %}
            <tr style="font-size: 120%;">
                <td class="text-center">{% include 'tabs/materials/_material-type-icon.twig' with { 'type':group.material_type } %}</td>
                <td>
                    {% include 'tabs/cutlist/_group-label.twig' %}
                    <div class="ladb-minitools no-print">
                        <a href="#ladb_group_{{ group.id }}" class="ladb-scrollto" data-toggle="tooltip" title="DÃ©filer vers le bloc"><i class="ladb-toolbox-icon-arrow-circle-down"></i></a>
                    </div>
                </td>
                <td class="text-center">x{{ group.part_count }}</td>
                <td class="text-right">{% if group.raw_area_m2 == 0 %}-{% else %}{{ group.raw_area_m2|number_format(3, ',', ' ') }}m<sup>2</sup>{% endif %}</td>
                <td class="text-right">{% if group.raw_volume_m3 == 0 %}-{% else %}{{ group.raw_volume_m3|number_format(3, ',', ' ') }}m<sup>3</sup>{% endif %}</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
{% endif %}
{% for group in groups %}
    <table id="ladb_group_{{ group.id }}" class="table table-bordered ladb-cutlist">
        <thead>
        <tr style="background-color: #eee;">
            <td colspan="{% if group.material_type > 0 %}8{% else %}6{% endif %}" style="line-height: 20px;">
                <button class="no-print btn btn-default btn-sm ladb-btn-toggle-no-print pull-left" data-group-id="ladb_group_{{ group.id }}"><i class="ladb-toolbox-icon-eye-close"></i></button>
                <div>
                    <span style=" line-height: 25px; font-size: 18px;">{% include 'tabs/materials/_material-type-icon.twig' with { 'type':group.material_type } %} {% include 'tabs/cutlist/_group-label.twig' %}</span>
                </div>
            </td>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td class="text-center" rowspan="2" style="vertical-align: middle !important;" width="5%">{{ 'tab.cutlist.list.number'|i18next }}</td>
            <td class="text-center" rowspan="2" style="vertical-align: middle !important;" width="{% if group.material_type > 0 %}37%{% else %}87%{% endif %}">{{ 'tab.cutlist.list.name'|i18next }}</td>
            <td class="text-center" rowspan="2" style="vertical-align: middle !important;" width="8%">{{ 'tab.cutlist.list.count'|i18next }}</td>
            {% if group.material_type > 0 %}
                <td class="text-center" colspan="2">{{ 'tab.cutlist.list.raw'|i18next }}</td>
                <td class="text-center" colspan="3">Finie</td>
            {% endif %}
        </tr>
        <tr>
            {% if group.material_type > 0 %}
                <td class="text-center" width="10%">{{ 'tab.cutlist.list.length_short'|i18next }}</td>
                <td class="text-center" width="10%">{{ 'tab.cutlist.list.width_short'|i18next }}</td>
                <td class="text-center" width="10%">{{ 'tab.cutlist.list.length_short'|i18next }}</td>
                <td class="text-center" width="10%">{{ 'tab.cutlist.list.width_short'|i18next }}</td>
                <td class="text-center" width="10%">{{ 'tab.cutlist.list.thickness_short'|i18next }}</td>
            {% endif %}
        </tr>
        {% set thickness = 0 %}
        {% for part in group.parts %}
            {% if group.material_type == 1 and part.thickness != thickness %}
                {% set thickness = part.thickness %}
                <tr style="background-color: #fcfcfc;">
                    <td colspan="8" style="padding: 5px 10px 5px 10px; font-size: 80%;">{{ 'tab.cutlist.list.thickness'|i18next }} {{ part.thickness }}</td>
                </tr>
            {% endif %}
            <tr style="font-size: 120%;" id="ladb_part_{{ part.id }}">
                <td class="text-center" style="color: red;">{{ part.number }}</td>
                <td>
                    {{ part.name|escape }}
                    <div class="ladb-minitools no-print">
                        {% for material_origin in part.material_origins %}
                            {% if material_origin > 1 %} {# OWNED origin are ignored #}
                                <a data-toggle="tooltip" title="{{ ('tab.cutlist.list.material_origin_'~material_origin)|i18next }}"><i class="ladb-toolbox-icon-material-origin-{{ material_origin }}"></i></a>
                            {% endif %}
                        {% endfor %}
                        &nbsp;<a class="ladb-btn-edit" data-part-id="{{ part.id }}" data-toggle="tooltip" title="{{ 'tab.cutlist.list.edit_part_properties'|i18next }}"><i class="ladb-toolbox-icon-edit"></i></a>
                    </div>
                </td>
                <td class="text-center">x {{ part.count }}</td>
                {% if group.material_type > 0 %}
                    <td class="text-right" style="color: red;">{{ part.raw_length }}</td>
                    <td class="text-right" style="color: red;">{{ part.raw_width }}</td>
                    <td class="text-right">{{ part.length }}</td>
                    <td class="text-right">{{ part.width }}</td>
                    <td class="text-right">{{ part.thickness }}</td>
                {% endif %}
            </tr>
        {% endfor %}
        </tbody>
    </table>
{% endfor %}