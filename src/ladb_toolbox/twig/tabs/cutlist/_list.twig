{# set errors #}
{# set warnings #}
{# set groups #}

{% include 'core/_alert-errors.twig' %}
{% include 'core/_alert-warnings.twig' %}
{% include 'core/_alert-tips.twig' %}

{% if groups|length > 0 %}
    <table id="ladb_group_summary" data-group-id="summary" class="{% if 'summary' in uiOptions.hidden_group_ids %}no-print {% endif %}table table-bordered ladb-cutlist-group">
        <thead>
        <tr>
            <td colspan="5">
                <button class="no-print btn btn-default btn-sm ladb-btn-toggle-no-print pull-left" data-toggle="tooltip" title="{{ 'tab.cutlist.tooltip.show_hide_block'|i18next }}"><i class="ladb-toolbox-icon-eye-open"></i></button>
                <div class="btn-group pull-right">
                    <button class="no-print btn btn-default ladb-btn-group-menu btn-sm" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="ladb-toolbox-icon-reorder"></i> <span class="caret"></span></button>
                    <ul class="dropdown-menu">
                        <li><a href="#" class="ladb-item-hide-all-other-groups"><i class="ladb-toolbox-icon-eye-close"></i> {{ 'tab.cutlist.menu.hide_all_other_groups'|i18next }}</a></li>
                    </ul>
                </div>
                <div>
                    <span class="ladb-heading">{{ 'tab.cutlist.list.summary'|i18next }}</span>
                </div>
            </td>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td class="text-center" width="5%">{{ 'tab.cutlist.list.type'|i18next }}</td>
            <td class="text-center" width="55%">{{ 'tab.cutlist.list.material_thickness'|i18next }}</td>
            <td class="text-center" width="10%">{{ 'tab.cutlist.list.part_count'|i18next }}</td>
            <td class="text-center" width="15%">{{ 'tab.cutlist.list.area'|i18next }}</td>
            <td class="text-center" width="15%">{{ 'tab.cutlist.list.volume'|i18next }}</td>
        </tr>
        {% for group in groups %}
            <tr class="ladb-cutlist-row">
                <td class="text-center">{% include 'tabs/materials/_material-type-icon.twig' with { 'type':group.material_type } %}</td>
                <td>
                    {% include 'tabs/cutlist/_group-label.twig' %}
                    <div class="ladb-minitools no-print">
                        <a href="#ladb_group_{{ group.id }}" class="ladb-btn-scrollto" data-toggle="tooltip" title="{{ 'tab.cutlist.tooltip.scroll_to_block'|i18next }}"><i class="ladb-toolbox-icon-arrow-circle-down"></i></a>
                    </div>
                </td>
                <td class="text-center">x {{ group.part_count }}</td>
                <td class="text-right">{% if group.raw_area_m2 == 0 %}-{% else %}{{ group.raw_area_m2|number_format(3, ',', ' ') }}m<sup>2</sup>{% endif %}</td>
                <td class="text-right">{% if group.raw_volume_m3 == 0 %}-{% else %}{{ group.raw_volume_m3|number_format(3, ',', ' ') }}m<sup>3</sup>{% endif %}</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
{% endif %}
{% if groups.length > 0 %}
    <hr class="no-print">
{% endif %}
{% for group in groups %}

    {% set showRawDimensions = group.material_type > 0 and not uiOptions.hide_raw_dimensions %}
    {% set showFinalDimensions = (group.material_type > 0 or group.material_type == 0 and not uiOptions.hide_untyped_material_dimensions) and not uiOptions.hide_final_dimensions %}
    {% set colspan = 8 %}
    {% if not showRawDimensions %}
        {% set colspan = colspan - 2 %}
    {% endif %}
    {% if not showFinalDimensions %}
        {% set colspan = colspan - 3 %}
    {% endif %}

    <table id="ladb_group_{{ group.id }}" data-group-id="{{ group.id }}" class="{% if group.id in uiOptions.hidden_group_ids %}no-print {% endif %}table table-bordered ladb-cutlist-group">
        <thead>
        <tr>
            <td colspan="{{ colspan }}">
                <button class="no-print btn btn-default btn-sm ladb-btn-toggle-no-print pull-left" data-toggle="tooltip" title="{{ 'tab.cutlist.tooltip.show_hide_block'|i18next }}"><i class="ladb-toolbox-icon-eye-close"></i></button>
                <div class="btn-group pull-right">
                    <button class="no-print btn btn-default ladb-btn-group-menu btn-sm" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="ladb-toolbox-icon-reorder"></i> <span class="caret"></span></button>
                    <ul class="dropdown-menu">
                        {#{% if group.material_name is not empty %}#}
                            {#<li><a href="#" class="ladb-item-edit-material"><i class="ladb-toolbox-icon-edit"></i> {{ 'tab.cutlist.menu.edit_material'|i18next({ 'material':group.material_name }) }}</a></li>#}
                        {#{% endif %}#}
                        <li><a href="#" class="ladb-item-edit-group"><i class="ladb-toolbox-icon-edit"></i> {{ 'tab.cutlist.menu.edit_group_properties'|i18next }}</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#" class="ladb-item-hide-all-other-groups"><i class="ladb-toolbox-icon-eye-close"></i> {{ 'tab.cutlist.menu.hide_all_other_groups'|i18next }}</a></li>
                    </ul>
                </div>
                <div>
                    <span class="ladb-heading">{% include 'tabs/materials/_material-type-icon.twig' with { 'type':group.material_type } %} {% include 'tabs/cutlist/_group-label.twig' %}</span>
                </div>
            </td>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td class="text-center" rowspan="2" style="vertical-align: middle !important;" width="5%">{{ 'tab.cutlist.list.number'|i18next }}</td>
            <td class="text-center" rowspan="2" style="vertical-align: middle !important;">{{ 'tab.cutlist.list.name'|i18next }}</td>
            <td class="text-center" rowspan="2" style="vertical-align: middle !important;" width="8%">{{ 'tab.cutlist.list.count'|i18next }}</td>
            {% if showRawDimensions %}
                <td class="text-center" colspan="2">{{ 'tab.cutlist.list.raw'|i18next }}</td>
            {% endif %}
            {% if showFinalDimensions %}
                <td class="text-center" colspan="3">{{ 'tab.cutlist.list.final'|i18next }}</td>
            {% endif %}
        </tr>
        <tr>
            {% if showRawDimensions %}
                <td class="text-center" width="10%">{{ 'tab.cutlist.list.length_short'|i18next }}</td>
                <td class="text-center" width="10%">{{ 'tab.cutlist.list.width_short'|i18next }}</td>
            {% endif %}
            {% if showFinalDimensions %}
                <td class="text-center" width="10%">{{ 'tab.cutlist.list.length_short'|i18next }}</td>
                <td class="text-center" width="10%">{{ 'tab.cutlist.list.width_short'|i18next }}</td>
                <td class="text-center" width="10%">{{ 'tab.cutlist.list.thickness_short'|i18next }}</td>
            {% endif %}
        </tr>
        {% set thickness = 0 %}
        {% for part in group.parts %}
            {% if showThicknessSeparators and showFinalDimensions and group.material_type == 1 and part.thickness != thickness %}
                {% set thickness = part.thickness %}
                <tr style="background-color: #fcfcfc;">
                    <td colspan="8" style="padding: 5px 10px 5px 10px; font-size: 80%;">{{ 'tab.cutlist.list.thickness'|i18next }} {{ part.thickness }}</td>
                </tr>
            {% endif %}
            <tr id="ladb_part_{{ part.id }}" class="ladb-cutlist-row">
                <td class="text-center" style="color: red;">{{ part.number }}</td>
                <td>
                    {{ part.name|escape }}
                    <div class="ladb-minitools no-print">
                        {% if part.orientation_locked_on_axis %}<a data-toggle="tooltip" title="{{ ('tab.cutlist.tooltip.orientation_locked_on_axis')|i18next }}"><i class="ladb-toolbox-icon-orientation-locked-on-axis"></i></a>{% endif %}
                        {% include 'tabs/cutlist/_material-origins.twig' with { 'materialOrigins':part.material_origins } %}
                        <span class="ladb-separator"></span>
                        &nbsp;<a class="ladb-btn-edit-part" data-part-id="{{ part.id }}" data-toggle="tooltip" title="{{ 'tab.cutlist.tooltip.edit_part_properties'|i18next }}"><i class="ladb-toolbox-icon-edit"></i></a>
                    </div>
                </td>
                <td class="text-center">{{ part.count }}</td>
                {% if showRawDimensions %}
                    <td class="text-right" style="color: red;">{{ part.raw_length }}{% if part.count > 1 and part.cumulable == 1 %}<br><small title="{{ part.count }} x {{ part.raw_length }} = {{ part.cumulative_raw_length }}" data-toggle="tooltip">&Sigma;&nbsp;=&nbsp;<em>{{part.cumulative_raw_length}}</em></small>{% endif %}</td>
                    <td class="text-right" style="color: red;">{{ part.raw_width }}{% if part.count > 1 and part.cumulable == 2 %}<br><small title="{{ part.count }} x {{ part.raw_width }}  = {{ part.cumulative_raw_width }}" data-toggle="tooltip">&Sigma;&nbsp;=&nbsp;<em>{{ part.cumulative_raw_width}}</em></small>{% endif %}</td>
                {% endif %}
                {% if showFinalDimensions %}
                    <td class="text-right">{{ part.length }}</td>
                    <td class="text-right">{{ part.width }}</td>
                    <td class="text-right">{{ part.thickness }}</td>
                {% endif %}
            </tr>
        {% endfor %}
        </tbody>
    </table>
{% endfor %}