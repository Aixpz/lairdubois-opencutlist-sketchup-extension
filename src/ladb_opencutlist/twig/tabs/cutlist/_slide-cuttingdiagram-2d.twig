{% extends 'tabs/base-slide.twig' %}

{% set id = 'ladb_cutlist_slide_cuttingdiagram_2d' %}
{% set out = true %}

{% set sheetDimensionFontSize = 18 %}
{% set dimensionFontSize = 13 %}
{% set numberFontSize = 26 %}

{% set dimensionOffset = 3 %}
{% set sheetDimensionOffset = 10 %}

{% set sheetOutlineWidth = 1 %}
{% set boxOutlineWidth = 2 %}
{% set cutOutlineWidth = 2 %}

{% block headerInner %}
    {{ parent() }}
    <ul class="ladb-file-tabs nav nav-tabs">
        {% include 'tabs/cutlist/_file-tab.twig' with { 'generatedAt':'000' } %}
    </ul>
{% endblock %}

{% block headerHeadingInner %}
    {{ 'tab.cutlist.cuttingdiagram.title'|i18next}} <small>| {{ group.material_name }} / <strong>{{ group.std_dimension}}</strong></small>
{% endblock %}

{% block headerToolsInner %}
    <button id="ladb_btn_print" class="btn btn-default"><i class="ladb-opencutlist-icon-print"></i> {{ 'default.print'|i18next }}</button>
    <button id="ladb_btn_close" class="btn btn-default"><i class="ladb-opencutlist-icon-close"></i> {{ 'default.close'|i18next }}</button>
{% endblock %}

{% block containerInner %}
    {{ parent() }}
    <div class="ladb-page">

        {% include 'core/_alert-errors.twig' %}
        {% include 'core/_alert-warnings.twig' %}
        {% include 'core/_alert-tips.twig' %}

        {% if unplaced_parts|length > 0 %}
            <div class="ladb-cuttingdiagram-group">

                <table class="table table-bordered ladb-cutlist-group">
                    <thead>
                    <tr>
                        <td colspan="5">
                            <button class="no-print btn btn-default btn-sm ladb-btn-toggle-no-print pull-left"><i class="ladb-opencutlist-icon-eye-close"></i></button>
                            <div>
                                <span class="ladb-heading text-danger"><i class="ladb-opencutlist-icon-warning"></i> {{ 'tab.cutlist.cuttingdiagram.list.unplaced_parts'|i18next }}</span>
                            </div>
                        </td>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td class="text-center" rowspan="2" style="vertical-align: middle !important;" width="5%">{{ 'tab.cutlist.cuttingdiagram.list.number'|i18next }}</td>
                        <td class="text-center" rowspan="2" style="vertical-align: middle !important;">{{ 'tab.cutlist.cuttingdiagram.list.name'|i18next }}</td>
                        <td class="text-center" rowspan="2" style="vertical-align: middle !important;" width="5%">{{ 'tab.cutlist.cuttingdiagram.list.count'|i18next }}</td>
                        <td class="text-center" colspan="2">{{ 'tab.cutlist.cuttingdiagram.list.raw'|i18next }}</td>
                    </tr>
                    <tr>
                        <td class="text-center" width="12%">{{ 'tab.cutlist.cuttingdiagram.list.length'|i18next }}</td>
                        <td class="text-center" width="12%">{{ 'tab.cutlist.cuttingdiagram.list.width'|i18next }}</td>
                    </tr>
                    {% for part in unplaced_parts  %}
                    <tr class="ladb-cutlist-row">
                        <td class="text-center">
                            {{ part.number }}
                        </td>
                        <td>
                            <div class="ladb-minitools no-print">
                                <span class="ladb-separator"></span>
                                <a href="#" class="ladb-btn-highlight-part" data-part-id="{{ part.id }}" data-toggle="tooltip" title="{{ 'tab.cutlist.tooltip.highlight_part'|i18next }}"><i class="ladb-opencutlist-icon-magnifier"></i></a>
                            </div>
                            {{ part.name|escape }}
                        </td>
                        <td class="text-center">
                            {{ part.count }}
                        </td>
                        <td class="text-right">
                            {{ part.length }}
                        </td>
                        <td class="text-right">
                            {{ part.width }}
                        </td>
                    </tr>
                    {% endfor %}
                    </tbody>
                </table>

            </div>
        {% endif %}
        {% for bin in bins %}
            <div class="ladb-cuttingdiagram-group">
                <table id="ladb_cuttingdiagram_group_{{ loop.index }}" class="table table-bordered ladb-cutlist-group" data-group-id="{{ loop.index }}">
                    <thead>
                    <tr>
                        <td colspan="2">
                            <button class="no-print btn btn-default btn-sm ladb-btn-toggle-no-print pull-left"><i class="ladb-opencutlist-icon-eye-close"></i></button>
                            <div>
                                <span class="ladb-heading"><i class="ladb-opencutlist-icon-sheet-good"></i> {{ group.material_name }} / <strong>{{ group.std_dimension }}</strong> - <i class="ladb-opencutlist-icon-size"></i> <em>{{ bin.length }} x {{ bin.width }}</em></span>
                                <div class="no-print btn-group pull-right" role="group">
                                    <button class="btn btn-default btn-sm ladb-btn-scrollto-prev-group" {% if loop.first %}disabled{% endif %}><i class="ladb-opencutlist-icon-chevron-left"></i></button>
                                    <button class="btn btn-default btn-sm ladb-btn-scrollto-next-group" {% if loop.last %}disabled{% endif %}><i class="ladb-opencutlist-icon-chevron-right"></i></button>
                                </div>
                                <span class="ladb-heading pull-right" style="margin-right: 10px;"><strong>{{ loop.index }} / {{ bins|length }}</strong></span>
                            </div>
                        </td>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td colspan="2">

                            <svg version=”1.1″ xmlns=”http://www.w3.org/2000/svg” xmlns:xlink=”http://www.w3.org/1999/xlink” viewBox="-{{ sheetOutlineWidth + sheetDimensionOffset + sheetDimensionFontSize }} -{{ sheetOutlineWidth + sheetDimensionOffset + sheetDimensionFontSize }} {{ bin.px_length + (sheetOutlineWidth + sheetDimensionOffset + sheetDimensionFontSize) * 2 }} {{ bin.px_width + (sheetOutlineWidth + sheetDimensionOffset + sheetDimensionFontSize) * 2 }}" height="{{ bin.px_width + (sheetOutlineWidth + sheetDimensionOffset + sheetDimensionFontSize) * 2 }}" style="max-height: {{ bin.px_width + sheetOutlineWidth * 2 + sheetDimensionOffset + sheetDimensionFontSize }}px">
                                <text class="sheet-dimension" x="{{ bin.px_length / 2 }}" y="-{{ sheetOutlineWidth + sheetDimensionOffset }}" font-size="{{ sheetDimensionFontSize }}px" text-anchor="middle" dominant-baseline="alphabetic">{{ bin.length }}</text>
                                <text class="sheet-dimension" x="-{{ sheetOutlineWidth + sheetDimensionOffset }}" y="{{ bin.px_width / 2 }}" font-size="{{ sheetDimensionFontSize }}px" text-anchor="middle" dominant-baseline="alphabetic" transform="rotate(-90 -{{ sheetOutlineWidth + sheetDimensionOffset }},{{ bin.px_width / 2 }})">{{ bin.width }}</text>
                                <g class="sheet">
                                    <rect class="sheet-outer" x="-1" y="-1" width="{{ bin.px_length + 2 }}" height="{{ bin.px_width + 2 }}"></rect>
                                    <rect class="sheet-inner" x="0" y="0" width="{{ bin.px_length }}" height="{{ bin.px_width }}"></rect>
                                </g>
                                {% for box in bin.boxes %}
                                    <g class="box" data-toggle="tooltip" data-html="true" title="<span style='font-size: 120%;'>{{ box.name }}</span><br>{{ box.length }}&nbsp;x&nbsp;{{ box.width }}">
                                        <rect class="box-outer" x="{{ box.px_x }}" y="{{ box.px_y }}" width="{{ box.px_length }}" height="{{ box.px_width }}"></rect>
                                        <rect class="box-inner" x="{{ box.px_x + boxOutlineWidth }}" y="{{ box.px_y + boxOutlineWidth }}" width="{{ box.px_length - boxOutlineWidth * 2 }}" height="{{ box.px_width - boxOutlineWidth * 2 }}"></rect>
                                        <text class="box-number" x="{{ box.px_x + box.px_length / 2 }}" y="{{ box.px_y + box.px_width / 2 }}" font-size="{{ min(numberFontSize, box.px_length - dimensionOffset * 2, box.px_width - dimensionOffset * 2)  }}px" text-anchor="middle" dominant-baseline="central"{% if box.rotated %} transform="rotate(-90 {{ box.px_x + box.px_length / 2 }},{{ box.px_y + box.px_width / 2 }})"{% endif %}>{{ box.number }}</text>
                                        {% set centredLength = box.px_width > (dimensionOffset + dimensionFontSize + numberFontSize) %}
                                        {% set centredWidth = box.px_length > (dimensionOffset + dimensionFontSize + numberFontSize) %}
                                        <text class="box-dimension" x="{{ centredLength ? box.px_x + box.px_length / 2 : box.px_x + boxOutlineWidth + dimensionOffset + dimensionFontSize + dimensionOffset }}" y="{{ box.px_y + boxOutlineWidth + dimensionOffset + dimensionFontSize }}" font-size="{{ dimensionFontSize }}px" text-anchor="{% if centredLength %}middle{% else %}start{% endif %}">{{ box.length }}</text>
                                        <text class="box-dimension" x="{{ box.px_x + boxOutlineWidth + dimensionOffset + dimensionFontSize }}" y="{{ centredWidth ? box.px_y + box.px_width / 2 : box.px_y + boxOutlineWidth + dimensionOffset + dimensionFontSize + dimensionOffset }}" font-size="{{ dimensionFontSize }}px" text-anchor="{% if centredWidth %}middle{% else %}end{% endif %}" transform="rotate(-90 {{ box.px_x + boxOutlineWidth + dimensionOffset + dimensionFontSize }},{{ centredWidth ? box.px_y + box.px_width / 2 : box.px_y + boxOutlineWidth + dimensionOffset + dimensionFontSize + dimensionOffset }})">{{ box.width }}</text>
                                    </g>
                                {% endfor %}
                                {% for leftover in bin.leftovers %}
                                    {% set hideCross = leftover.px_length < dimensionFontSize or leftover.px_width < dimensionFontSize %}
                                    {% set hideDimensions = leftover.px_length < (dimensionFontSize + dimensionOffset) or leftover.px_width < (dimensionFontSize + dimensionOffset) %}
                                    <g class="leftover">
                                        <rect class="leftover-inner" x="{{ leftover.px_x }}" y="{{ leftover.px_y }}" width="{{ leftover.px_length }}" height="{{ leftover.px_width }}"></rect>
                                        {% if not hideCross %}
                                            <line class="leftover-cross" x1="{{ leftover.px_x + leftover.px_length }}" y1="{{ leftover.px_y }}" x2="{{ leftover.px_x }}" y2="{{ leftover.px_y + leftover.px_width }}"></line>
                                            <line class="leftover-cross" x1="{{ leftover.px_x }}" y1="{{ leftover.px_y }}" x2="{{ leftover.px_x + leftover.px_length }}" y2="{{ leftover.px_y + leftover.px_width }}"></line>
                                        {% endif %}
                                        {% if not hideDimensions %}
                                            <text class="leftover-dimension" x="{{ leftover.px_x + leftover.px_length / 2 }}" y="{{ leftover.px_y + dimensionOffset + dimensionFontSize }}" font-size="{{ dimensionFontSize }}px" text-anchor="middle">{{ leftover.length }}</text>
                                            <text class="leftover-dimension" x="{{ leftover.px_x + dimensionOffset + dimensionFontSize }}" y="{{ leftover.px_y + leftover.px_width / 2 }}" font-size="{{ dimensionFontSize }}px" text-anchor="middle" transform="rotate(-90 {{ leftover.px_x + dimensionOffset + dimensionFontSize }},{{ leftover.px_y + leftover.px_width / 2 }})">{{ leftover.width }}</text>
                                        {% endif %}
                                    </g>
                                {% endfor %}
                                {% for cut in bin.cuts %}
                                    <g class="cut">
                                        <rect class="cut-outer" x="{{ cut.px_x - cutOutlineWidth }}" y="{{ cut.px_y - cutOutlineWidth }}" width="{{ (cut.is_horizontal ? cut.px_length : px_saw_kerf) + cutOutlineWidth * 2 }}" height="{{ (cut.is_horizontal ? px_saw_kerf : cut.px_length) + cutOutlineWidth * 2 }}"></rect>
                                        <rect class="cut-inner" x="{{ cut.px_x }}" y="{{ cut.px_y }}" width="{{ cut.is_horizontal ? cut.px_length : px_saw_kerf }}" height="{{ cut.is_horizontal ? px_saw_kerf : cut.px_length }}"></rect>
                                    </g>
                                {% endfor %}
                            </svg>

                        </td>
                    </tr>
                    <tr>
                        <td>
                            <span><i class="ladb-opencutlist-icon-grained-{{ rotatable ? '0' : '1' }}"></i> {{ ('tab.materials.edit_material.grained_'~(rotatable ? '0' : '1'))|i18next }}</span>{% if trimming > 0 %}<span style="margin-left: 10px; border-left: 1px solid #ddd; padding-left: 10px;"><strong>{{ 'tab.cutlist.cuttingdiagram.list.trimming'|i18next }} : </strong>{{ trimming }}</span>{% endif %}
                        </td>
                        <td width="12%" class="ladb-nowrap"><strong>{{ 'tab.cutlist.cuttingdiagram.list.efficiency'|i18next }} : </strong>{{ bin.efficiency }}</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        {% endfor %}
    </div>
{% endblock %}